<!DOCTYPE html>
<html>
<head>
    <title>Approve First Admin</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #0E9F6E; }
        button { background: #0E9F6E; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #0D8A5F; }
        .info { background: #E0F2FE; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #0EA5E9; }
        .success { background: #D1FAE5; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #10B981; }
        .error { background: #FEE2E2; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #EF4444; }
        .user-card { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #F59E0B; }
        .user-card.approved { border-left-color: #10B981; }
        pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Approve First Admin User</h1>
        
        <div class="info">
            <strong>Instructions:</strong><br>
            Click "Load Users" to see all registered users, then approve one as admin.
        </div>

        <button onclick="loadUsers()">Load All Users</button>
        
        <div id="result"></div>
        <div id="userList"></div>

        <h2>Alternative: Direct SQL</h2>
        <div class="info">If the button doesn't work, connect to PostgreSQL and run:</div>
        <pre>-- List all users
SELECT id, email, full_name, role, is_approved, is_active FROM users;

-- Approve a user (replace EMAIL)
UPDATE users 
SET is_approved = true, is_active = true, role = 'super_admin'
WHERE email = 'YOUR_EMAIL_HERE';</pre>
    </div>

    <script>
        const API = 'https://plasticsurg.duckdns.org/api';

        async function loadUsers() {
            const result = document.getElementById('result');
            const list = document.getElementById('userList');
            
            result.innerHTML = '<div class="info">Loading...</div>';
            list.innerHTML = '';

            try {
                const res = await fetch(API + '/users/all');
                
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error || res.statusText);
                }

                const users = await res.json();
                
                result.innerHTML = '<div class="success">Found ' + users.length + ' user(s)</div>';
                
                users.forEach(user => {
                    const div = document.createElement('div');
                    div.className = 'user-card' + (user.is_approved ? ' approved' : '');
                    div.innerHTML = 
                        '<strong>' + user.full_name + '</strong> ' + 
                        (user.is_approved ? 'APPROVED' : 'PENDING') + '<br>' +
                        'Email: ' + user.email + '<br>' +
                        'Role: ' + user.role + '<br>' +
                        'Department: ' + (user.department || 'N/A') + '<br>' +
                        (!user.is_approved ? 
                            '<button onclick="approve(\'' + user.id + '\', \'' + user.email + '\')">Approve as Super Admin</button>' 
                            : '');
                    list.appendChild(div);
                });

            } catch (error) {
                result.innerHTML = '<div class="error">Error: ' + error.message + '<br><br>Use the SQL method below instead.</div>';
            }
        }

        async function approve(id, email) {
            if (!confirm('Approve ' + email + ' as Super Admin?')) return;

            const result = document.getElementById('result');
            result.innerHTML = '<div class="info">Approving...</div>';

            try {
                const res = await fetch(API + '/users/' + id + '/approve-direct', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error || res.statusText);
                }

                result.innerHTML = '<div class="success">Success! You can now log in as ' + email + '</div>';
                setTimeout(loadUsers, 1000);

            } catch (error) {
                result.innerHTML = '<div class="error">Error: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>
